{
  "hash": "ab5d200604081062651b73e3f04cf6df",
  "result": {
    "markdown": "---\ntitle: \"DID\"\nauthor: \"Caio Lopes\"\ndate: \"2025-04-19\"\ncategories: [Ensino]\n#image: \"image.jpg\"\n---\n\n\n# Introdução\n\nNormalmente, o pesquisador não tem acesso a dados de experimentos controlados e randomizados. Mesmo assim o infêrencial  causal continua sendo de interesse. O método de diferenças em diferenças utiliza a dinamica temporal para dirimir a víes de seleção. A sua beleza reside na simplicidade com que, sob certas hipóteses, consegue isolar o efeito de um tratamento, controlando por fatores não observáveis que poderiam confundir a nossa análise.\n\nNeste post, vamos mergulhar na intuição por trás do DiD. Começaremos com a intuição do método. Em seguida, desvendaremos como o DiD elimina o viés de seleção, qual a sua hipótese fundamental -- as tendências paralelas -- e como podemos testá-la visualmente através de estudos de eventos. Por fim, abordaremos uma extensão robusta, as Triplas Diferenças (DDD), e ilustraremos todos esses conceitos com dados simulados, mostrando o poder do método na prática.\n\n# A desoneração da folha de pagamentos\n\nNo início dos anos 2010, o governo brasileiro enfrentava preocupações sobre a competitividade da indústria nacional e o custo elevado da mão de obra. A contribuição previdenciária patronal de 20% sobre a folha de salários era vista como um entrave à geração de empregos, especialmente em setores intensivos em trabalho. Em resposta, o governo implementou a desoneração da folha através da Lei nº 12.546/2011, que entrou em vigor em 2012.\n\nA política permitiu que empresas de setores específicos optassem por pagar uma contribuição sobre a receita bruta (com alíquotas variando de 1% a 4,5%) em vez dos tradicionais 20% sobre a folha.\n\nDo ponto de vista da inferência causal, essa política criou uma situação quasi-experimental ideal para aplicação do DiD:\n\n1.  **Grupo de Tratamento**: Empresas em setores desonerados \n2.  **Grupo de Controle**: Empresas em setores não desonerados\n3.  **Período Pré-Tratamento**: 2007-2011 (antes da implementação)\n4.  **Período Pós-Tratamento**: 2012-2015 (após a implementação)\n5.  **Outcome de Interesse**: Número de trabalhadores empregados\n\n\n## A Intuição do Método DiD\n\n### Por que Comparações Simples Falham?\n\nImagine que queremos avaliar se a desoneração aumentou o emprego. Poderíamos ser tentados a fazer duas comparações simples:\n\n1.  **Comparação Cross-Sectional (2012-2017)**: Comparar o emprego médio nos setores desonerados com os não desonerados após a política. O problema? Os setores desonerados (como TI e construção civil) já eram naturalmente mais intensivos em mão de obra *antes* da política. Essa diferença estrutural entre os setores é o que chamamos de **viés de seleção** ou **efeito fixo de grupo**.\n\n2.  **Comparação Temporal (Setores Desonerados)**: Comparar o emprego nos setores desonerados antes e depois de 2012. O problema? Entre 2008 e 2017, a economia brasileira passou por ciclos de crescimento e recessão que afetaram todos os setores. Atribuir toda a mudança à desoneração ignoraria essas **tendências temporais comuns**.\n\n### O DiD\nO DiD combina ambas as abordagens de forma engenhosa. A primeira diferença (temporal) para cada grupo remove os efeitos fixos. A segunda diferença (entre grupos) remove as tendências temporais comuns. O que sobra é o efeito causal da política.\n\nVamos decompor isso com um exemplo intuitivo usando símbolos:\n\n| **Grupo** | **Antes (2008-2011)** | **Depois (2012-2017)** | **Diferença Temporal** |\n|--------------------|------------------|------------------|------------------|\n| **Setores Desonerados** | D + S | D + S + T + E | T + E |\n| **Setores Não Desonerados** | S | S + T | T |\n| **Diferença entre Grupos** | D | D + E | **E** ← **DiD** |\n\n**Legenda dos Efeitos:** - **D**: Efeito fixo dos setores desonerados (ex: TI e construção são naturalmente mais intensivos em mão de obra) - **S**: Efeito fixo dos setores não desonerados (baseline comum)\\\n- **T**: Tendência temporal comum (crescimento/recessão econômica que afeta todos os setores) - **E**: **Efeito causal da desoneração** (o que queremos estimar!)\n\n**Como o DiD Funciona:**\n\n1.  **Primeira diferença temporal** elimina os efeitos fixos (D e S desaparecem)\n2.  **Segunda diferença entre grupos** elimina a tendência temporal comum (T desaparece)\\\n3.  **O que sobra é E**: o efeito causal puro da desoneração\n\nFormalmente, o estimador DiD é:\n\n$$\nDiD = [E[Y | D=1, Post] - E[Y | D=1, Pre]] - [E[Y | D=0, Post] - E[Y | D=0, Pre]]\n$$\n\n\n## Como o DiD Elimina o Viés de Seleção do ATT\n\n### O Problema Fundamental da Inferência Causal\n\n\nO que realmente queremos estimar é o **Efeito Médio do Tratamento sobre os Tratados (ATT)**:\n\n$$\nATT = E[Y^{1} | D=1] - E[Y^{0} | D=1]\n$$\n\nOnde $Y^{1}$ é o emprego com desoneração e $Y^{0}$ é o emprego sem desoneração. O primeiro termo é observável (vemos o emprego nos setores desonerados após 2012). O problema é o segundo termo: o emprego **contrafactual** que teria ocorrido nos setores desonerados se a política não tivesse sido implementada. Esse contrafactual é, por definição, inobservável.\n\nComo agora acompanhamos as unidades no tempo, podemos reescrever nosso ATT como:\n\n$$\nATT = E[Y^{1} | D=1, Post] - E[Y^{0} | D=1, Post]\n$$\n\nUma vez que se $D=1$ estamos considerando o período pós tratamento.\n\n\n### A Hipótese de Tendências Paralelas\n\nO DiD resolve esse problema fazendo uma hipótese crucial: na ausência do tratamento, a trajetória do emprego nos setores desonerados teria sido a mesma que a trajetória observada nos setores não desonerados. Formalmente:\n\n$$\nE[Y^{0} | D=1, Post] - E[Y^{0} | D=1, Pre] = E[Y^{0} | D=0, Post] - E[Y^{0} | D=0, Pre=1]\n$$\n\nEm palavras: a mudança no emprego para os setores controle é um bom proxy para a mudança que *teria ocorrido* nos setores desonerados na ausência da política. Se essa hipótese for válida, o DiD identifica perfeitamente o ATT.\n\n### Decomposição do Estimador\n\nPodemos decompor o estimador DiD da seguinte forma:\n$$\nDiD = ATT + [E[Y^{0}|D=1,Post] - E[Y^{0}|D=1,Pre]] - [E[Y^{0} |D=0,Post] - E[Y^{0}|D=0,Pre]]\n$$\nO segundo termo é o viés de tendências não-paralelas. Se as tendências forem paralelas (segundo termo = 0), então **DiD = ATT**. O método usa a tendência do grupo controle para construir o contrafactual não observado do grupo tratado.\n\nPara entender como chegamos na decomposição acima, vamos rescrever o estimador DiD por meio dos resultados potenciais: \n\n$$\nDiD = [E[Y^{1} | D=1, Post] - E[Y^{0} | D=1, Pre]] - [E[Y^{0} | D=0, Post] - E[Y^{0} | D=0, Pre]]\n$$\nSomando e subtraindo do lado direito da equação por $[E[Y^{0} | D=1, Post]$, temos: \n\n$$\nDiD = [E[Y^{1} | D=1, Post] - E[Y^{0} | D=1, Pre]] - [E[Y^{0} | D=0, Post] - E[Y^{0} | D=0, Pre]] + ([E[Y^{0} | D=1, Post] - [E[Y^{0} | D=1, Post])\n$$\nRearranjando as expressões temos: \n\n$$\nDiD = [E[Y^{1} | D=1, Post] - [E[Y^{0} | D=1, Post] + [E[Y^{0} | D=1, Post] - E[Y^{0} | D=1, Pre]] - [E[Y^{0} | D=0, Post] - E[Y^{0} | D=0, Pre]]  \n$$\nEm que:\n\n* $[E[Y^{1} | D=1, Post] - [E[Y^{0} | D=1, Post]= ATT$\n* $[E[Y^{0} | D=1, Post] - E[Y^{0} | D=1, Pre]] - [E[Y^{0} | D=0, Post] - E[Y^{0} | D=0, Pre]]$ é o viés causado por tendencias não paralelas \n\n### Outras Hipóteses Necessárias\n\nAlém de tendências paralelas, o DiD requer:\n\n1.  **SUTVA (Stable Unit Treatment Value Assumption)**: O tratamento de uma empresa não afeta o resultado de outras\n2.  **Exogeneidade do Timing**: A implementação em 2012 não foi antecipada de forma a alterar comportamentos pré-tratamento\n3.  **Composição Estável**: A composição dos setores não muda drasticamente (ex: empresas não migram entre setores)\n\n## Do Cálculo Manual à Regressão OLS\n\nAté agora, estimamos o DiD calculando manualmente as diferenças de médias. Mas há uma forma mais elegante e flexível: **regressão por Mínimos Quadrados Ordinários (OLS)**. Surpreendentemente, uma regressão simples com uma interação recupera *exatamente* o mesmo estimador DiD.\n\n### A Especificação de Regressão\n\nConsidere o seguinte modelo de regressão linear:\n\n$$Y_{it} = \\beta_0 + \\beta_1 \\text{Desonerado}_i + \\beta_2 \\text{Post}_t + \\beta_3 (\\text{Desonerado}_i \\times \\text{Post}_t) + \\varepsilon_{it}$$\n\nOnde:\n- $Y_{it}$ é o número de trabalhadores na empresa $i$ no período $t$\n- $\\text{Desonerado}_i = 1$ se a empresa está em setor desonerado, 0 caso contrário\n- $\\text{Post}_t = 1$ se o período é pós-2012, 0 caso contrário\n- $\\text{Desonerado}_i \\times \\text{Post}_t$ é a **interação** entre tratamento e período\n\n**Interpretação dos Coeficientes:**\n- $\\beta_0$: Emprego médio nos setores não desonerados antes de 2012 (grupo base)\n- $\\beta_1$: Diferença fixa entre setores desonerados e não desonerados (efeito fixo de grupo)\n- $\\beta_2$: Mudança temporal comum a todos os setores (tendência temporal)\n- $\\beta_3$: **Efeito causal da desoneração (DiD/ATT)**\n\n### Demonstração Matemática: $\\beta_3 = \\text{DiD}$\n\nVamos provar que $\\beta_3$ é exatamente igual ao estimador DiD que calculamos manualmente.\n\n**Passo 1: Valores Esperados para Cada Grupo-Período**\n\nUsando a equação de regressão, podemos calcular o valor esperado de $Y$ para cada combinação de grupo e período:\n\n| Grupo | Período | Desonerado | Post | Interação | $E[Y]$ |\n|-------|---------|------------|------|-----------|--------|\n| Não Desonerado | Antes | 0 | 0 | 0 | $\\beta_0$ |\n| Não Desonerado | Depois | 0 | 1 | 0 | $\\beta_0 + \\beta_2$ |\n| Desonerado | Antes | 1 | 0 | 0 | $\\beta_0 + \\beta_1$ |\n| Desonerado | Depois | 1 | 1 | 1 | $\\beta_0 + \\beta_1 + \\beta_2 + \\beta_3$ |\n\n**Passo 2: Primeira Diferença (Temporal) para Cada Grupo**\n\n*Setores Desonerados:*\n$$\\Delta_{\\text{Desonerado}} = (\\beta_0 + \\beta_1 + \\beta_2 + \\beta_3) - (\\beta_0 + \\beta_1) = \\beta_2 + \\beta_3$$\n\n*Setores Não Desonerados:*\n$$\\Delta_{\\text{Não Desonerado}} = (\\beta_0 + \\beta_2) - \\beta_0 = \\beta_2$$\n\n**Passo 3: Segunda Diferença (DiD)**\n\n$$\\text{DiD} = \\Delta_{\\text{Desonerado}} - \\Delta_{\\text{Não Desonerado}} = (\\beta_2 + \\beta_3) - \\beta_2 = \\beta_3$$\n\n**Conclusão:** O coeficiente da interação $\\beta_3$ é **exatamente** o estimador DiD! ∎\n\n### Visualização da Decomposição\n\nPodemos reorganizar a tabela acima para ver claramente como cada componente contribui:\n\n| Grupo | Período | Valor Esperado | Decomposição |\n|-------|---------|----------------|--------------|\n| Não Desonerado | Antes | $\\beta_0$ | Baseline |\n| Não Desonerado | Depois | $\\beta_0 + \\beta_2$ | Baseline + Tendência |\n| Desonerado | Antes | $\\beta_0 + \\beta_1$ | Baseline + Efeito Fixo |\n| Desonerado | Depois | $\\beta_0 + \\beta_1 + \\beta_2 + \\beta_3$ | Baseline + Efeito Fixo + Tendência + **DiD** |\n\nNote que:\n- $\\beta_0$ cancela em todas as diferenças\n- $\\beta_1$ cancela na diferença temporal\n- $\\beta_2$ cancela na diferença entre grupos\n- **$\\beta_3$ sobrevive como o único termo não cancelado**\n\n## Aplicação Prática com Dados Simulados (N=100)\n\nPara tornar os conceitos mais concretos, vamos simular dados de painel com 100 empresas (50 em setores desonerados, 50 em setores controle) ao longo de 9 anos (2007-2015). A desoneração é implementada em 2012 e tem um efeito verdadeiro de **+25 trabalhadores**.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Configurar seed para reprodutibilidade\nset.seed(42)\n\n# Parâmetros da simulação\nn_empresas <- 100\nn_anos <- 9  # 2007-2015\nano_inicio <- 2007\nano_desoneracao <- 2012\n\n# Metade das empresas em setores desonerados\nn_desonerado <- n_empresas / 2\n\n# Criar data frame vazio\ndados <- data.frame()\n\nfor (i in 1:n_empresas) {\n  # Determinar se empresa está em setor desonerado\n  desonerado <- ifelse(i <= n_desonerado, 1, 0)\n  \n  # Efeito fixo da empresa\n  # Setores desonerados têm baseline maior (mais intensivos em mão de obra)\n  efeito_fixo <- 100 + (30 * desonerado) + rnorm(1, mean = 0, sd = 10)\n  \n  for (t in 0:(n_anos - 1)) {\n    ano <- ano_inicio + t\n    \n    # Tendência temporal comum (crescimento econômico)\n    tendencia_temporal <- 5 * t\n    \n    # Efeito da desoneração (apenas após 2012 para setores desonerados)\n    efeito_desoneracao <- ifelse(desonerado == 1 & ano >= ano_desoneracao, 25, 0)\n    \n    # Ruído aleatório\n    erro <- rnorm(1, mean = 0, sd = 5)\n    \n    # Número de trabalhadores\n    n_trabalhadores <- efeito_fixo + tendencia_temporal + efeito_desoneracao + erro\n    \n    # Criar variável post\n    post <- ifelse(ano >= ano_desoneracao, 1, 0)\n    \n    # Criar variável de interação\n    desoneracao <- desonerado * post\n    \n    # Adicionar linha ao data frame\n    dados <- rbind(dados, data.frame(\n      empresa_id = i,\n      ano = ano,\n      tempo = t,\n      desonerado = desonerado,\n      post = post,\n      desoneracao = desoneracao,\n      n_trabalhadores = n_trabalhadores\n    ))\n  }\n}\n```\n:::\n\n\n###Regressão OLS\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Estimar modelo: Y = β0 + β1*Desonerado + β2*Post + β3*(Desonerado×Post) + ε\nmodelo <- lm(n_trabalhadores ~ desonerado + post + desoneracao, data = dados)\n\n# Mostrar sumário da regressão\nsummary(modelo)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = n_trabalhadores ~ desonerado + post + desoneracao, \n    data = dados)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-38.276  -8.393   0.250   8.211  36.977 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 110.1420     0.7956  138.43   <2e-16 ***\ndesonerado   31.5908     1.1252   28.07   <2e-16 ***\npost         22.1818     1.1935   18.59   <2e-16 ***\ndesoneracao  25.2538     1.6878   14.96   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.58 on 896 degrees of freedom\nMultiple R-squared:  0.8349,\tAdjusted R-squared:  0.8344 \nF-statistic:  1510 on 3 and 896 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n#### Interpretação dos Coeficientes\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Extrair coeficientes\nbeta_0 <- coef(modelo)[\"(Intercept)\"]\nbeta_1 <- coef(modelo)[\"desonerado\"]\nbeta_2 <- coef(modelo)[\"post\"]\nbeta_3 <- coef(modelo)[\"desoneracao\"]\n\ncat(\"\\n=== INTERPRETAÇÃO DOS COEFICIENTES ===\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n=== INTERPRETAÇÃO DOS COEFICIENTES ===\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(sprintf(\"β₀ (Intercepto):         %.4f\\n\", beta_0))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nβ₀ (Intercepto):         110.1420\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(\"   → Emprego médio nos setores não desonerados antes de 2012\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   → Emprego médio nos setores não desonerados antes de 2012\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(sprintf(\"β₁ (Desonerado):         %.4f\\n\", beta_1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nβ₁ (Desonerado):         31.5908\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(\"   → Diferença fixa entre setores (efeito fixo de grupo)\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   → Diferença fixa entre setores (efeito fixo de grupo)\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(sprintf(\"β₂ (Post):               %.4f\\n\", beta_2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nβ₂ (Post):               22.1818\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(\"   → Tendência temporal comum (crescimento econômico)\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   → Tendência temporal comum (crescimento econômico)\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(sprintf(\"β₃ (Desonerado × Post):  %.4f ***\\n\", beta_3))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nβ₃ (Desonerado × Post):  25.2538 ***\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(\"   → EFEITO CAUSAL DA DESONERAÇÃO (DiD/ATT)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   → EFEITO CAUSAL DA DESONERAÇÃO (DiD/ATT)\n```\n:::\n:::\n\n\n### Visualização: Tendências Paralelas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular médias por ano e grupo\nmedias_ano <- aggregate(n_trabalhadores ~ ano + desonerado, data = dados, FUN = mean)\n\n# Criar gráfico\npar(mar = c(5, 5, 4, 2))\n\n# Plotar setores não desonerados\nplot(medias_ano$ano[medias_ano$desonerado == 0], \n     medias_ano$n_trabalhadores[medias_ano$desonerado == 0],\n     type = \"b\", pch = 15, col = \"#e74c3c\", lwd = 3, cex = 1.5,\n     xlab = \"Ano\", ylab = \"Número de Trabalhadores\",\n     main = \"Impacto da Desoneração da Folha no Emprego\\nTendências Paralelas\",\n     ylim = range(medias_ano$n_trabalhadores),\n     cex.lab = 1.3, cex.main = 1.4, cex.axis = 1.2)\n\n# Adicionar setores desonerados\nlines(medias_ano$ano[medias_ano$desonerado == 1], \n      medias_ano$n_trabalhadores[medias_ano$desonerado == 1],\n      type = \"b\", pch = 16, col = \"#27ae60\", lwd = 3, cex = 1.5)\n\n# Linha vertical no ano da desoneração\nabline(v = ano_desoneracao - 0.5, col = \"gray\", lty = 2, lwd = 2.5)\n\n# Legenda\nlegend(\"topleft\", \n       legend = c(\"Setores Desonerados\", \"Setores Não Desonerados\"),\n       col = c(\"#27ae60\", \"#e74c3c\"), \n       pch = c(16, 15), \n       lwd = 3, \n       cex = 1.2,\n       bty = \"n\")\n\n# Anotação\ntext(ano_desoneracao - 0.5, max(medias_ano$n_trabalhadores) * 0.95, \n     \"Lei 12.546/2011\\nDesoneração (2012)\", \n     pos = 4, cex = 1.1, font = 2)\n\n# Grid\ngrid(col = \"gray\", lty = \"dotted\")\n```\n\n::: {.cell-output-display}\n![Tendências paralelas em dados simulados da desoneração da folha. As trajetórias são similares antes de 2012 e divergem após a implementação da política.](index_files/figure-html/grafico-tendencias-1.png){width=960}\n:::\n:::\n\n\n### Resultados\n\nO gráfico acima visualiza as tendências paralelas. Note como:\n\n1. **Antes de 2012**: As linhas dos dois grupos são aproximadamente paralelas, validando visualmente nossa hipótese identificadora\n2. **Após 2012**: A linha dos setores desonerados se afasta para cima, capturando o efeito positivo da política\n3. **Magnitude**: O gap vertical entre as linhas após 2012 representa o efeito DiD de aproximadamente **+25 trabalhadores**\n\n**Tabela Resumo dos Resultados:**\n\n| Método | Estimativa | Erro Padrão | Estatística t | p-valor |\n|--------|------------|-------------|---------------|---------|\n| DiD Manual | +25.25 | - | - | - |\n| Regressão OLS (β₃) | +25.25 | 1.69 | 14.96 | < 0.001 |\n\n**Conclusão:** A desoneração da folha aumentou o emprego em aproximadamente **25 trabalhadores** nas empresas beneficiadas, controlando por tendências temporais comuns e diferenças fixas entre setores. O efeito é altamente significativo estatisticamente.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}