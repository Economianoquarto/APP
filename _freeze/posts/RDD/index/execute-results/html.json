{
  "hash": "1e4b0df372580566c4fa40cfb4d88b23",
  "result": {
    "markdown": "---\ntitle: \"RDD\"\nauthor: \"Caio Lopes\"\ndate: \"2025-04-19\"\ncategories: [Ensino]\n#image: \"image.jpg\"\n---\n\n\n# Introdução\n\nO *Regression Discontinuity Design* (RDD), ou Regressão com Descontinuidade, é mais um método para estimação do efeito causais (treatment effect).\n\nSua a fundamentação teórica, encontra-se no trabalho seminal de **Hahn, Todd e Van der Klaauw (2001)** \\[1\\], que formalizou as condições sob as quais o RDD identifica um efeito de tratamento causal. Em seguida, faremos um paralelo entre duas aplicações empíricas clássicas:\n\n1.  **Lee (2008)** \\[2\\]: O estudo sobre a vantagem eleitoral de incumbentes nos EUA, um exemplo de como uma regra (vencer por uma margem mínima) cria um quase-experimento.\n\n2.  **Carpenter & Dobkin (2009)** \\[3\\]: A análise do efeito da idade mínima para consumo de álcool sobre a mortalidade, um caso onde a variável de tratamento é perfeitamente determinada por uma lei.\n\n# A Fundação Teórica\n\nO artigo de Hahn, Todd e Van der Klaauw (HTV) foi crucial para estabelecer a credibilidade do RDD como um método quase-experimental. Eles mostraram que, sob hipoteses relativamente fracas, o RDD pode identificar um efeito de tratamento local com a mesma validade de um experimento aleatório.\n\n## O Setup Básico do RDD\n\nImagine uma situação onde uma intervenção (tratamento) é atribuída com base em uma **variável de continuidade** (*running variable*), que chamaremos de `Z`. Existe um **ponto de corte** (*cutoff*), `c`, que determina quem recebe o tratamento. Por exemplo, `Z` pode ser a nota de um aluno em um exame, e todos com nota `Z >= c` recebem uma bolsa de estudos.\n\nO RDD explora a ideia de que indivíduos com valores de `Z` muito próximos ao cutoff `c`, mas de lados opostos, são, em média, muito semelhantes em todas as outras características (observáveis e não observáveis). A única diferença sistemática entre eles é o recebimento do tratamento. Portanto, qualquer \"salto\" ou **descontinuidade** na variável de resultado nesse ponto pode ser atribuído ao efeito causal do tratamento.\n\n## Sharp vs. Fuzzy RDD\n\nHTV formalizam a distinção entre dois tipos de RDD:\n\n1.  **Sharp RDD (RDD Nítido)**: O tratamento é uma função determinística do cutoff. Todos os indivíduos com `Z >= c` recebem o tratamento, e ninguém com `Z < c` o recebe. A probabilidade de tratamento salta de 0 para 1 exatamente no cutoff.\n\n2.  **Fuzzy RDD (RDD Difuso)**: O cutoff influencia a *probabilidade* de receber o tratamento, mas não a determina perfeitamente. Por exemplo, uma bolsa de estudos pode ser *oferecida* a todos com `Z >= c`, mas nem todos a aceitam. Nesse caso, a probabilidade de tratamento salta de um valor `p_abaixo` para um valor `p_acima` no cutoff, mas não necessariamente de 0 para 1.\n\n## A Condição de Identificação Fundamental\n\nA grande contribuição de HTV foi esclarecer o pressuposto central que permite a identificação do efeito causal. Este pressuposto é a **continuidade das funções de regressão dos resultados potenciais no cutoff**.\n\nVamos definir os resultados potenciais:\n\n-   `Y(1)`: O resultado que um indivíduo teria se recebesse o tratamento.\n-   `Y(0)`: O resultado que o mesmo indivíduo teria se não recebesse o tratamento.\n\nO pressuposto fundamental do RDD é que as médias condicionais de `Y(1)` e `Y(0)` são contínuas em relação à variável de continuidade `Z` no ponto `c`.\n\n> **Pressuposto de Continuidade (HTV, 2001):** As funções `E[Y(1) | Z=z]` e `E[Y(0) | Z=z]` são contínuas em `z=c`.\n\nEm palavras simples, isso significa que, na ausência do tratamento, a relação entre a variável de continuidade e o resultado seria suave e não teria um salto no cutoff. Se essa condição for válida, qualquer salto observado no resultado real no cutoff deve ser atribuído ao tratamento.\n\n## O que o RDD Estima: O LATE\n\nSob este pressuposto, HTV mostram que o RDD identifica o **Efeito Médio do Tratamento Local** (*Local Average Treatment Effect* - LATE) no cutoff. O estimador é a razão entre o salto no resultado e o salto na probabilidade de tratamento:\n\n$$ \\text{LATE} = \\frac{\\lim_{z \\to c^+} E[Y|Z=z] - \\lim_{z \\to c^-} E[Y|Z=z]}{\\lim_{z \\to c^+} E[D|Z=z] - \\lim_{z \\to c^-} E[D|Z=z]} $$\n\nOnde: - `Y` é o resultado observado. - `D` é o indicador de tratamento (0 ou 1). - O numerador é o \"salto\" no resultado no cutoff. - O denominador é o \"salto\" na probabilidade de tratamento no cutoff.\n\nNo caso de um **Sharp RDD**, o denominador é 1 (o salto na probabilidade é de 0 para 1), então o LATE é simplesmente o tamanho do salto no resultado.\n\n# Parte 2: O Paralelo Teórico nas Aplicações\n\nOs estudos de Lee (2008) e Carpenter & Dobkin (2009) são exemplos perfeitos que ilustram a teoria de HTV em contextos muito diferentes. Ambos são **Sharp RDDs** e sua credibilidade reside na impossibilidade (ou grande dificuldade) de manipular a variável de continuidade.\n\nVamos comparar os dois estudos lado a lado:\n\n| Característica | Lee (2008): Vantagem de Incumbência | Carpenter & Dobkin (2009): Álcool e Mortalidade |\n|------------------|---------------------------|---------------------------|\n| **Questão Causal** | Qual o efeito causal de vencer uma eleição sobre os votos na próxima? | Qual o efeito causal do acesso legal ao álcool sobre a mortalidade? |\n| **Variável de Continuidade (Z)** | Margem de vitória do partido Democrata na eleição *t-1*. | Idade do indivíduo. |\n| **Cutoff (c)** | 0 (zero). | 21 anos. |\n| **Tratamento (D)** | Vencer a eleição em *t-1* (ser o incumbente). | Ter permissão legal para comprar e consumir álcool. |\n| **Resultado (Y)** | Porcentagem de votos do partido Democrata na eleição *t*. | Taxa de mortalidade (por todas as causas, acidentes, suicídio, etc.). |\n| **Tipo de RDD** | **Sharp RDD**. A vitória é uma função determinística da margem \\> 0. | **Sharp RDD**. A permissão legal é uma função determinística da idade. |\n\n## A Lógica da Identificação em Cada Contexto\n\n### Lee (2008): Eleições como Experimentos Aleatórios\n\nA genialidade do estudo de Lee é argumentar que, em eleições muito disputadas (com margem de vitória próxima de zero), o vencedor é **tão bom quanto aleatório**. Um candidato que vence por 0.1% dos votos é, em média, extremamente semelhante a um que perde por 0.1%. Eles têm financiamento, qualidade e apelo eleitoral virtualmente idênticos.\n\n-   **Validade do Pressuposto de Continuidade**: É plausível que a porcentagem de votos na próxima eleição (`Y`) variaria suavemente com a margem de vitória anterior (`Z`) se não houvesse o \"prêmio\" da incumbência. Não há razão para acreditar que um candidato que vence por 0.1% teria uma trajetória de votos futura drasticamente diferente de um que perde por 0.1%, a não ser pelo fato de ter vencido.\n-   **Impossibilidade de Manipulação**: É extremamente difícil para um candidato controlar o resultado de uma eleição com precisão suficiente para garantir uma vitória por uma margem mínima. \n\nO estudo encontra um salto de cerca de **7-8 pontos percentuais** na porcentagem de votos na eleição seguinte, que é o LATE da incumbência.\n\n### Carpenter & Dobkin (2009): Leis como Descontinuidades Perfeitas\n\nEste estudo explora uma regra institucional ainda mais rígida: a idade mínima para o consumo de álcool (MLDA - *Minimum Legal Drinking Age*).\n\n-   **Validade do Pressuposto de Continuidade**: A variável de continuidade é a idade. É altamente plausível que a taxa de mortalidade (`Y`) mude suavemente com a idade (`Z`). Não há razão biológica ou social para que a mortalidade de uma pessoa salte abruptamente no dia do seu 21º aniversário, a não ser por uma mudança de comportamento induzida por uma nova permissão legal.\n-   **Impossibilidade de Manipulação**: A idade de uma pessoa é uma variável que não pode ser manipulada. Ninguém pode escolher fazer 21 anos mais cedo para beber legalmente. Isso torna o design RDD extremamente crível neste contexto.\n\nO estudo encontra um salto discreto de cerca de **9% na taxa de mortalidade** geral logo após os 21 anos, atribuído ao aumento do consumo de álcool e comportamentos de risco associados.\n\n# Conclusão: A Unidade na Diversidade do RDD\n\nAo comparar os estudos de Lee (2008) e Carpenter & Dobkin (2009) através das lentes teóricas de Hahn, Todd e Van der Klaauw (2001), vemos um padrão unificador. Ambos os estudos, embora aplicados a domínios completamente diferentes (ciência política e saúde pública), compartilham a mesma lógica fundamental:\n\n1.  **Identificam uma regra arbitrária** (vencer uma eleição, atingir 21 anos) que gera uma descontinuidade no tratamento.\n2.  **Argumentam que a variável de continuidade não é manipulável** em torno do cutoff, garantindo que a comparação local seja válida.\n3.  **Demonstram visualmente e estimam quantitativamente um \"salto\"** na variável de resultado, que, sob o pressuposto de continuidade, pode ser interpretado como um efeito causal local.\n\nO RDD, portanto, nos permite transformar dados observacionais em evidências quase-experimentais, fornecendo respostas críveis para algumas das questões mais importantes das ciências sociais aplicadas.\n\n# Replicação de Carpenter & Dobkin (2009)\n\nO Blog de Leppert (2020) \\[4\\] traz um tutorial de como aplicar o RDD por da replicação de Carpenter & Dobkin (2009) usando o pacote `rddtools`.\n\nPrimeiro, vamos carregar todos os pacotes necessários para a análise.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Instalar pacotes se necessário\nif (!require(\"dplyr\")) install.packages(\"dplyr\")\nif (!require(\"ggplot2\")) install.packages(\"ggplot2\")\nif (!require(\"rddtools\")) install.packages(\"rddtools\")\nif (!require(\"magrittr\")) install.packages(\"magrittr\")\n\n# Carregar pacotes\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(rddtools)\nlibrary(magrittr)\n```\n:::\n\n\nAgora, vamos carregar os dados reais do estudo (estão disponíveis no github de Leppert\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncarpenter_dobkin_2009 <- readRDS(\"carpenter_dobkin_2009.rds\")\n```\n:::\n\n\nVamos visualizar os dados. Há um salto notável na taxa de mortalidade aos 21 anos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncarpenter_dobkin_2009 %>% \n  ggplot(aes(x = agecell, y = all)) + \n  geom_point() +\n  geom_vline(xintercept = 21, color = \"red\", size = 1, linetype = \"dashed\") + \n  annotate(\"text\", x = 20.4, y = 105, label = \"Minimum Drinking Age\",\n           size=4) +\n  labs(y = \"Mortality rate (per 100.000)\",\n       x = \"Age (binned)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_scatter_tutorial-1.png){width=672}\n:::\n:::\n\n\n\nO RDD pode ser estimado por OLS. A primeira regressão aplica a mesma inclinação em ambos os lados do cutoff.\n\n\nPrimeiro, criamos uma variável dummy (`threshold`). Em seguida, especificamos um modelo linear para regredir a mortalidade (`all`) na dummy `threshold` e na idade (`agecell`) centrada em 21.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_same_slope <- carpenter_dobkin_2009 %>% \n  mutate(threshold = ifelse(agecell >= 21, 1, 0)) %$% \n  lm(all ~ threshold + I(agecell - 21))\n\nsummary(lm_same_slope)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = all ~ threshold + I(agecell - 21))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-5.0559 -1.8483  0.1149  1.4909  5.8043 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      91.8414     0.8050 114.083  < 2e-16 ***\nthreshold         7.6627     1.4403   5.320 3.15e-06 ***\nI(agecell - 21)  -0.9747     0.6325  -1.541     0.13    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.493 on 45 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.5946,\tAdjusted R-squared:  0.5765 \nF-statistic: 32.99 on 2 and 45 DF,  p-value: 1.508e-09\n```\n:::\n:::\n\n\n\nO pacote `rddtools` simplifica este processo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdd_data(y = carpenter_dobkin_2009$all, \n         x = carpenter_dobkin_2009$agecell, \n         cutpoint = 21) %>% \n  rdd_reg_lm(slope = \"same\") %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ ., data = dat_step1, weights = weights)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-5.0559 -1.8483  0.1149  1.4909  5.8043 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  91.8414     0.8050 114.083  < 2e-16 ***\nD             7.6627     1.4403   5.320 3.15e-06 ***\nx            -0.9747     0.6325  -1.541     0.13    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.493 on 45 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.5946,\tAdjusted R-squared:  0.5765 \nF-statistic: 32.99 on 2 and 45 DF,  p-value: 1.508e-09\n```\n:::\n:::\n\n\nO gráfico mostra a linha de regressão ajustada, que tem a mesma inclinação em ambos os lados do cutoff.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncarpenter_dobkin_2009 %>%\n  select(agecell, all) %>%\n  mutate(threshold = as.factor(ifelse(agecell >= 21, 1, 0))) %>%\n  ggplot(aes(x = agecell, y = all)) +\n  geom_point(aes(color = threshold)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_color_brewer(palette = \"Accent\") +\n  guides(color = FALSE) +\n  geom_vline(xintercept = 21, color = \"red\",\n    size = 1, linetype = \"dashed\") +\n  labs(y = \"Mortality rate (per 100.000)\",\n       x = \"Age (binned)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The `<scale>` argument of `guides()` cannot be `FALSE`. Use \"none\" instead as\nof ggplot2 3.3.4.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_same_slope_tutorial-1.png){width=672}\n:::\n:::\n\n\nO coeficiente da variável dummy `threshold` é o efeito médio do tratamento. Em média, a taxa de mortalidade por 100.000 para indivíduos que atingem a idade mínima para beber é **7.66** pontos mais alta.\n\nA segunda regressão aplica inclinações diferentes em ambos os lados do cutoff.\nIsso é alcançado especificando uma interação entre a dummy `threshold` e a idade centrada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_different_slope <- carpenter_dobkin_2009 %>%\n  mutate(threshold = ifelse(agecell >= 21, 1, 0)) %$%\n  lm(all ~ threshold + I(agecell - 21) + threshold:I(agecell - 21))\n\nsummary(lm_different_slope)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = all ~ threshold + I(agecell - 21) + threshold:I(agecell - \n    21))\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-4.368 -1.787  0.117  1.108  5.341 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                93.6184     0.9325 100.399  < 2e-16 ***\nthreshold                   7.6627     1.3187   5.811  6.4e-07 ***\nI(agecell - 21)             0.8270     0.8189   1.010  0.31809    \nthreshold:I(agecell - 21)  -3.6034     1.1581  -3.111  0.00327 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.283 on 44 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.6677,\tAdjusted R-squared:  0.645 \nF-statistic: 29.47 on 3 and 44 DF,  p-value: 1.325e-10\n```\n:::\n:::\n\nNo `rddtools`, usamos o argumento `slope = \"separate\"`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdd_data(y = carpenter_dobkin_2009$all, \n         x = carpenter_dobkin_2009$agecell, \n         cutpoint = 21) %>% \n  rdd_reg_lm(slope = \"separate\") %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ ., data = dat_step1, weights = weights)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-4.368 -1.787  0.117  1.108  5.341 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  93.6184     0.9325 100.399  < 2e-16 ***\nD             7.6627     1.3187   5.811  6.4e-07 ***\nx             0.8270     0.8189   1.010  0.31809    \nx_right      -3.6034     1.1581  -3.111  0.00327 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.283 on 44 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.6677,\tAdjusted R-squared:  0.645 \nF-statistic: 29.47 on 3 and 44 DF,  p-value: 1.325e-10\n```\n:::\n:::\n\nO gráfico mostra as diferentes inclinações.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncarpenter_dobkin_2009 %>%\n  select(agecell, all) %>%\n  mutate(threshold = as.factor(ifelse(agecell >= 21, 1, 0))) %>%\n  ggplot(aes(x = agecell, y = all, color = threshold)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_color_brewer(palette = \"Accent\") +\n  guides(color = FALSE) +\n  geom_vline(xintercept = 21, color = \"red\",\n    size = 1, linetype = \"dashed\") +\n  labs(y = \"Mortality rate (per 100.000)\",\n       x = \"Age (binned)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_different_slope_tutorial-1.png){width=672}\n:::\n:::\n\n\nEsta abordagem não altera a interpretação do efeito do tratamento! Em média, a taxa de mortalidade por 100.000 para indivíduos que atingem a idade mínima para beber é **7.66** pontos mais alta.\n\n### Análise de Sensibilidade: Modificando a Forma Funcional\n\nDeve-se prestar atenção especial à especificação da forma funcional.\n\nAbaixo, modelamos uma relação quadrática entre idade e mortalidade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_quadratic <- carpenter_dobkin_2009 %>% \nmutate(threshold = ifelse(agecell >= 21, 1, 0)) %$% \n  lm(all ~ threshold + I(agecell - 21) + I((agecell -21)^2) + threshold:I(agecell - 21) +\n       threshold:I((agecell - 21)^2))\n\nsummary(lm_quadratic)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = all ~ threshold + I(agecell - 21) + I((agecell - \n    21)^2) + threshold:I(agecell - 21) + threshold:I((agecell - \n    21)^2))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.3343 -1.3946  0.1849  1.2848  5.0817 \n\nCoefficients:\n                              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                    93.0729     1.4038  66.301  < 2e-16 ***\nthreshold                       9.5478     1.9853   4.809 1.97e-05 ***\nI(agecell - 21)                -0.8306     3.2901  -0.252    0.802    \nI((agecell - 21)^2)            -0.8403     1.6153  -0.520    0.606    \nthreshold:I(agecell - 21)      -6.0170     4.6529  -1.293    0.203    \nthreshold:I((agecell - 21)^2)   2.9042     2.2843   1.271    0.211    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.285 on 42 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.6821,\tAdjusted R-squared:  0.6442 \nF-statistic: 18.02 on 5 and 42 DF,  p-value: 1.624e-09\n```\n:::\n:::\n\n\n\nEm `rdd_reg_lm()`, modificamos o argumento `order = 2`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdd_data(y = carpenter_dobkin_2009$all, \n         x = carpenter_dobkin_2009$agecell, \n         cutpoint = 21) %>% \n  rdd_reg_lm(slope = \"separate\", order = 2) %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ ., data = dat_step1, weights = weights)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.3343 -1.3946  0.1849  1.2848  5.0817 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  93.0729     1.4038  66.301  < 2e-16 ***\nD             9.5478     1.9853   4.809 1.97e-05 ***\nx            -0.8306     3.2901  -0.252    0.802    \n`x^2`        -0.8403     1.6153  -0.520    0.606    \nx_right      -6.0170     4.6529  -1.293    0.203    \n`x^2_right`   2.9042     2.2843   1.271    0.211    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.285 on 42 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.6821,\tAdjusted R-squared:  0.6442 \nF-statistic: 18.02 on 5 and 42 DF,  p-value: 1.624e-09\n```\n:::\n:::\n\n\n\nÀ direita do cutoff, este modelo parece se ajustar melhor aos dados!\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncarpenter_dobkin_2009 %>%\n  select(agecell, all) %>%\n  mutate(threshold = as.factor(ifelse(agecell >= 21, 1, 0))) %>%\n  ggplot(aes(x = agecell, y = all, color = threshold)) +\n  geom_point() +\n  geom_smooth(method = \"lm\",\n              formula = y ~ x + I(x ^ 2),\n              se = FALSE) +\n  scale_color_brewer(palette = \"Accent\") +\n  guides(color = FALSE) +\n  geom_vline(xintercept = 21, color = \"red\",\n    size = 1, linetype = \"dashed\") +\n  labs(y = \"Mortality rate (per 100.000)\",\n       x = \"Age (binned)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_quadratic_tutorial-1.png){width=672}\n:::\n:::\n\n\nEm média, a taxa de mortalidade por 100.000 para indivíduos que atingem a idade mínima para beber é agora **9.55** pontos mais alta.\n\n### Análise de Sensibilidade: Tamanho do amostra (Sensibilidade ao Bandwidth)\n\nÉ aconselhável verificar a sensibilidade dos resultados em relação à limitação do tamanho da amostra.\n\nEm vez de usar toda a faixa de idade, usamos apenas indivíduos com idade entre 20 e 22 anos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_sensitivity <- carpenter_dobkin_2009 %>%\n  filter(agecell >= 20 & agecell <= 22) %>%\n  mutate(threshold = ifelse(agecell >= 21, 1, 0)) %$%\n  lm(all ~ threshold + I(agecell - 21) + threshold:I(agecell - 21))\n\nsummary(lm_sensitivity)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = all ~ threshold + I(agecell - 21) + threshold:I(agecell - \n    21))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.3038 -0.9132 -0.1746  1.1758  4.3307 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                 92.524      1.370  67.550  < 2e-16 ***\nthreshold                    9.753      1.937   5.035 6.34e-05 ***\nI(agecell - 21)             -1.612      2.407  -0.669    0.511    \nthreshold:I(agecell - 21)   -3.289      3.405  -0.966    0.346    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.366 on 20 degrees of freedom\n  (2 observations deleted due to missingness)\nMultiple R-squared:  0.7161,\tAdjusted R-squared:  0.6735 \nF-statistic: 16.82 on 3 and 20 DF,  p-value: 1.083e-05\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncarpenter_dobkin_2009 %>%\n  filter(agecell >= 20 & agecell <= 22) %>%\n  select(agecell, all) %>%\n  mutate(threshold = as.factor(ifelse(agecell >= 21, 1, 0))) %>%\n  ggplot(aes(x = agecell, y = all, color = threshold)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_color_brewer(palette = \"Accent\") +\n  guides(color = FALSE) +\n  geom_vline(xintercept = 21, color = \"red\",\n             size = 1, linetype = \"dashed\") +\n  labs(y = \"Mortality rate (per 100.000)\",\n       x = \"Age (binned)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_sensitivity_tutorial-1.png){width=672}\n:::\n:::\n\n\nEste resultado é bastante semelhante à abordagem anterior com o modelo quadrático. Em média, a taxa de mortalidade por 100.000 para indivíduos que atingem a idade mínima para beber é **9.75** pontos mais alta.\n\nUsando o `rddtools` podemos fazer a análise por ordem do polinômio\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdd_sens <-rdd_data(y = carpenter_dobkin_2009$all, \n         x = carpenter_dobkin_2009$agecell, \n         cutpoint = 21) \n\nrdd_sens_ik <- rdd_bw_ik(rdd_sens)\nrdd_sens2 <- rdd_reg_lm(rdd_object=rdd_sens, order=2, bw=rdd_sens_ik) \n\n\nplotSensi(rdd_sens2, from=1, to=5, by=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/rddtools_Bandwidth-1.png){width=672}\n:::\n:::\n\n\n### Análise de Sensibilidade: placebo do cutoff\n\nPodemos repetir a análise para placebos falsos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotPlacebo(rdd_sens2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/rddtools_placebo-1.png){width=672}\n:::\n:::\n\n\n\n\n# Referências\n\n\\[1\\] Hahn, J., Todd, P., & Van der Klaauw, W. (2001). Identification and Estimation of Treatment Effects with a Regression-Discontinuity Design. *Econometrica, 69*(1), 201-209.\n\n\\[2\\] Lee, D. S. (2008). Randomized experiments from non-random selection in U.S. House elections. *Journal of Econometrics*, 142(2), 675-697.\n\n\\[3\\] Carpenter, C., & Dobkin, C. (2009). The Effect of Alcohol Consumption on Mortality: Regression Discontinuity Evidence from the Minimum Drinking Age. *American Economic Journal: Applied Economics, 1*(1), 164–182.\n\n\\[4\\] Leppert, P. R Tutorial: Regression Discontinuity Design. Disponível em: https://rpubs.com/phle/r_tutorial_regression_discontinuity_design. Acesso em: 01/12/2025.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}