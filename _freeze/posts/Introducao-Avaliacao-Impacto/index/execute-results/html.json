{
  "hash": "9379cdb65144422246eee8d694eb7a54",
  "result": {
    "markdown": "---\ntitle: \"Introdução à avaliação de Impacto\"\nauthor: \"Caio Lopes\"\ndate: \"2025-04-19\"\ncategories: [Ensino]\n#image: \"image.jpg\"\n---\n\n\n\n## Introdução: Desvendando o Impacto Real das Ações\n\nVocê já se perguntou qual o verdadeiro efeito de um novo programa educacional nas notas dos alunos? Ou se uma campanha de marketing realmente aumentou as vendas de um produto? A **avaliação de impacto** é a ferramenta que nos permite responder a essas perguntas de forma rigorosa. Ela busca medir a contribuição de uma intervenção ou programa para um resultado de interesse, comparando o que aconteceu com a intervenção com o que teria acontecido sem ela — o chamado **contrafactual**.\n\nO grande desafio é que nunca observamos essa realidade alternativa. Não podemos, para o mesmo indivíduo e ao mesmo tempo, saber o que aconteceria com e sem o programa. Portanto, a avaliação de impacto é, em essência, um exercício de construção de um contrafactual crível para isolar o efeito causal da intervenção de todos os outros fatores que podem influenciar o resultado.\n\nNeste guia, vamos explorar os conceitos e métodos que formam a base da avaliação de impacto e da inferência causal, desde a teoria dos resultados potenciais até as técnicas mais utilizadas no mercado e na academia.\n\n::: {.callout-note}\n\n## O Problema Central\n\nO desafio da avaliação de impacto é estimar um contrafactual — o que teria acontecido na ausência do programa — para isolar o verdadeiro efeito da intervenção.\n\n:::\n\n\n\n## Quando Avaliar: Ex-Ante vs. Ex-Post\n\nA decisão de quando realizar uma avaliação de impacto é crucial e depende dos objetivos. Existem dois momentos principais:\n\n- **Avaliação Ex-Ante:** Realizada *antes* da implementação do programa, ela projeta os possíveis impactos e custos. Seu principal objetivo é informar a decisão sobre a adoção do programa, comparar alternativas de desenho e justificar o investimento. Por natureza, baseia-se em modelos teóricos e simulações, pois ainda não existem dados de beneficiários.\n\n- **Avaliação Ex-Post:** Realizada *durante* ou *após* a execução do programa. Ela pode ser:\n    - **De percurso:** Acontece enquanto o programa está em andamento. É ideal para verificar se as previsões ex-ante estão se confirmando e para orientar ajustes, aperfeiçoando o desenho em tempo real. É comum em programas piloto ou contínuos.\n    - **De encerramento:** Feita após o término da intervenção, busca julgar a eficácia da alocação de recursos e capturar impactos de longo prazo, que podem demorar a se manifestar. Ajuda a consolidar o aprendizado e a informar o desenho de futuros programas.\n\nEm resumo, a avaliação ex-ante foca no planejamento e na otimização do desenho, enquanto a ex-post se concentra em medir o impacto real e gerar aprendizados a partir da experiência.\n\n\n\n\n## Correlação não Implica Causalidade\n\nUm dos mantras mais repetidos em estatística e ciência de dados é: **correlação não implica causalidade**. Encontrar uma associação estatística entre duas variáveis, A e B, não é suficiente para concluir que A causa B. Existem pelo menos quatro possibilidades:\n\n1.  **Causalidade Direta:** A de fato causa B (A → B).\n2.  **Causalidade Reversa:** B, na verdade, causa A (B → A).\n3.  **Fator de Confusão:** Uma terceira variável, C, é a verdadeira causa tanto de A quanto de B (A ← C → B).\n4.  **Coincidência:** A correlação observada é puramente acidental, um ruído nos dados sem significado prático.\n\nPor exemplo, o aumento nas vendas de sorvete pode estar correlacionado com o aumento no número de afogamentos. Seria um erro concluir que tomar sorvete causa afogamentos. O fator de confusão aqui é o **verão**: dias mais quentes (C) levam as pessoas a comprarem mais sorvete (A) e também a nadarem mais (B), aumentando o risco de afogamentos.\n\nPara que a causalidade de A para B seja plausível, a correlação é uma condição necessária (a menos que um outro fator C anule exatamente o efeito de A), mas definitivamente não é uma condição suficiente. A inferência causal busca justamente métodos para ir além da simples correlação e isolar o verdadeiro efeito causal.\n\n\n\n_## O Modelo de Resultados Potenciais: Formalizando a Causalidade\n\nPara superar o desafio do contrafactual, o **Modelo de Resultados Potenciais** (Potential Outcomes), popularizado por Donald Rubin, oferece uma estrutura conceitual poderosa. A ideia é definir a causalidade em termos de resultados que *poderiam* ter acontecido.\n\n### A Ideia Central\n\nPara cada unidade de análise (um indivíduo, uma empresa, uma escola), imaginamos dois estados do mundo:\n\n-   $Y_i^1$: O resultado que a unidade *i* teria se recebesse o tratamento (D=1).\n-   $Y_i^0$: O resultado que a mesma unidade *i* teria se não recebesse o tratamento (D=0).\n\nO **efeito causal individual** do tratamento para a unidade *i* é a diferença entre esses dois resultados potenciais:\n\n$$\n\\delta_i = Y_i^1 - Y_i^0\n$$\n\nO problema fundamental, como já vimos, é que para cada unidade *i*, só podemos observar um desses resultados. O outro permanece um contrafactual. A equação de comutação formaliza isso:\n\n$$\nY_i = D_i \\cdot Y_i^1 + (1 - D_i) \\cdot Y_i^0\n$$\n\nOnde $D_i$ é uma variável que indica se a unidade *i* recebeu o tratamento ($D_i=1$) ou não ($D_i=0$).\n\n### Efeitos Médios de Interesse\n\nComo não podemos estimar o efeito individual para todos, o foco da avaliação de impacto se volta para os **efeitos médios** em uma população:\n\n-   **ATE (Average Treatment Effect):** O efeito médio do tratamento para a população como um todo. É a média de todos os efeitos individuais.\n    \n    $$\n    ATE = E[\\delta_i] = E[Y^1] - E[Y^0]\n    $$\n    \n-   **ATT (Average Treatment Effect on the Treated):** O efeito médio do tratamento apenas para aqueles que efetivamente o receberam.\n    \n    $$\n    ATT = E[\\delta_i | D=1] = E[Y^1 | D=1] - E[Y^0 | D=1]\n    $$\n    \n-   **ATU (Average Treatment Effect on the Untreated):** O efeito médio do tratamento caso ele fosse aplicado naqueles que não o receberam.\n    \n    $$\n    ATU = E[\\delta_i | D=0] = E[Y^1 | D=0] - E[Y^0 | D=0]\n    $$\n\nQuando os efeitos do tratamento são heterogêneos (ou seja, variam entre os indivíduos), esses três parâmetros podem ser bem diferentes. Por exemplo, um programa de qualificação profissional pode ter um impacto muito maior (ATT) para os que escolheram participar do que teria para a população em geral (ATE).\n\n### Por que a Simples Comparação de Médias é Enganosa\n\nUma primeira abordagem, mais ingênua, seria simplesmente comparar a média do resultado para o grupo que recebeu o tratamento com a média do grupo que não recebeu:\n\n$$\n\\text{Diferença ingênua} = E[Y | D=1] - E[Y | D=0]\n$$\n\nNo entanto, essa diferença quase nunca corresponde ao verdadeiro efeito causal. Uma decomposição matemática revela por quê:\n\n$$\nE[Y | D=1] - E[Y | D=0] = ATT + (E[Y^0 | D=1] - E[Y^0 | D=0])\n$$\n\nO segundo termo, $E[Y^0 | D=1] - E[Y^0 | D=0]$, é o **viés de seleção**. Ele representa a diferença que já existia entre os grupos *antes mesmo do tratamento*. Se os indivíduos que procuram um curso de qualificação (D=1) já são, em média, mais motivados e teriam salários mais altos ($Y^0$) do que os que não procuram (D=0), a comparação simples irá superestimar o efeito do curso, misturando o impacto real com essa diferença pré-existente.\n\n> A moral da história é que as escolhas (auto-seleção para o tratamento) são geralmente **endógenas**, ou seja, correlacionadas com os resultados potenciais. Sem uma fonte de variação **exógena** (aleatória), a comparação bruta é quase sempre enviesada.\n\n\n\n## Decompondo o ATE\n\nUma das relações mais importantes na inferência causal é como o **Average Treatment Effect (ATE)** pode ser decomposto em função do **Average Treatment Effect on the Treated (ATT)** e do **Average Treatment Effect on the Untreated (ATU)**. Esta decomposição é crucial para entender a heterogeneidade dos efeitos do tratamento, o viés de seleção e como generalizar resultados de um grupo para toda a população.\n\nO ATE pode ser expresso como uma média ponderada do ATT e ATU, onde os pesos são as proporções de indivíduos tratados e não tratados na população:\n\n$$\nATE = P(D=1) \\times ATT + P(D=0) \\times ATU\n$$\n\nEssa fórmula nos mostra que o efeito médio geral é uma combinação dos efeitos específicos em cada grupo. Se o efeito do tratamento for maior para aqueles que o escolheram (ATT > ATU), e esse grupo for grande, o ATE será mais próximo do ATT. A derivação matemática, baseada na lei da expectativa total, revela como essa relação emerge naturalmente das definições de cada parâmetro.\n\n\n\n_\n\n\n### Exemplo Prático: Programa de Treinamento Profissional\n\nImagine um programa de treinamento profissional onde 40% dos trabalhadores elegíveis decidem participar. É razoável supor que aqueles que participam são diferentes daqueles que não participam (e.g., mais motivados), e que o efeito do treinamento pode ser diferente para esses dois grupos.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Configurando dados hipotéticos\nset.seed(42)\nn_total <- 1000\nprop_treated <- 0.4\n\n# Efeitos heterogêneos\natt_true <- 5000\natu_true <- 2000\n\n# Resultados potenciais\nn_treated <- round(n_total * prop_treated)\ny0_treated <- rnorm(n_treated, mean = 30000, sd = 5000)\ny1_treated <- y0_treated + att_true + rnorm(n_treated, mean = 0, sd = 1000)\n\nn_untreated <- n_total - n_treated\ny0_untreated <- rnorm(n_untreated, mean = 25000, sd = 5000)\ny1_untreated <- y0_untreated + atu_true + rnorm(n_untreated, mean = 0, sd = 1000)\n\n# Criando data frame\ndata <- tibble(\n  id = 1:n_total,\n  D = c(rep(1, n_treated), rep(0, n_untreated)),\n  Y0 = c(y0_treated, y0_untreated),\n  Y1 = c(y1_treated, y1_untreated)\n) %>%\n  mutate(Y_obs = D * Y1 + (1 - D) * Y0)\n\n# Calculando os efeitos\neffects <- data %>%\n  summarise(\n    ATT = mean(Y1[D == 1]) - mean(Y0[D == 1]),\n    ATU = mean(Y1[D == 0]) - mean(Y0[D == 0]),\n    ATE_direct = mean(Y1) - mean(Y0),\n    prop_treated = mean(D)\n  ) %>%\n  mutate(ATE_decomposed = prop_treated * ATT + (1 - prop_treated) * ATU)\n\n# Exibindo resultados\ncat(\"ATT (efeito nos tratados): $\", round(effects$ATT, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nATT (efeito nos tratados): $ 4907.124 \n```\n:::\n\n```{.r .cell-code}\ncat(\"ATU (efeito nos não-tratados): $\", round(effects$ATU, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nATU (efeito nos não-tratados): $ 2017.598 \n```\n:::\n\n```{.r .cell-code}\ncat(\"ATE (cálculo direto): $\", round(effects$ATE_direct, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nATE (cálculo direto): $ 3173.408 \n```\n:::\n\n```{.r .cell-code}\ncat(\"ATE (via decomposição): $\", round(effects$ATE_decomposed, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nATE (via decomposição): $ 3173.408 \n```\n:::\n:::\n\n\nEste código simula uma população onde o grupo tratado tem um salário base maior e um efeito do tratamento mais elevado, refletindo um cenário de auto-seleção positiva. Os resultados do cálculo confirmam a decomposição do ATE e mostram como o ATE é uma média ponderada do ATT e do ATU.\n\n[Visualizar exemplo em excel](ate_decomposicao.xlsx){target=\"_blank\"}\n\n### Por que Esta Decomposição Importa?\n\nA decomposição do ATE em função do ATT e ATU tem implicações profundas para a interpretação de resultados e o desenho de políticas públicas.\n\n**Viés de Seleção:** A comparação ingênua entre tratados e controles pode ser decomposta como:\n\n$$\nE[Y | D=1] - E[Y | D=0] = ATT + \\text{Viés de Seleção}\n$$\n\nOnde o viés de seleção é $E[Y^0 | D=1] - E[Y^0 | D=0]$, representando a diferença que já existia entre os grupos antes do tratamento. Se os indivíduos que procuram um curso de qualificação já são mais motivados e teriam salários mais altos mesmo sem o curso, a comparação simples superestimará o efeito do programa.\n\n**Implicações para Política Pública:** Considere dois cenários para o programa de treinamento:\n\n1. **Expansão Total:** Oferecer o programa para toda a população elegível\n2. **Manutenção:** Manter apenas para quem já participa\n\nA análise custo-benefício deve considerar que o efeito médio para novos participantes (ATU) pode ser diferente do efeito para os participantes atuais (ATT). Se o ATU for significativamente menor que o ATT, a expansão pode não ser custo-efetiva, mesmo que o programa atual seja bem-sucedido.\n\n**Generalização de Resultados:** Quando extrapolamos resultados de um estudo para uma população diferente, precisamos considerar se a composição da nova população (proporção de \"tipos\" de indivíduos) é similar à do estudo original. Um programa que funciona bem em uma população com alta proporção de indivíduos motivados pode ter resultados diferentes em uma população com características distintas.\n\n\nPodemos também criar uma visualização para melhor compreender a distribuição dos efeitos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Criando visualização dos efeitos individuais\ndata %>%\n  mutate(individual_effect = Y1 - Y0) %>%\n  ggplot(aes(x = individual_effect, fill = factor(D))) +\n  geom_histogram(alpha = 0.7, bins = 30, position = \"identity\") +\n  geom_vline(xintercept = effects$ATE_direct, color = \"red\", linetype = \"dashed\", size = 1) +\n  labs(\n    title = \"Distribuição dos Efeitos Individuais do Tratamento\",\n    x = \"Efeito Individual ($)\",\n    y = \"Frequência\",\n    fill = \"Grupo\",\n    caption = \"Linha vermelha tracejada representa o ATE\"\n  ) +\n  scale_fill_discrete(labels = c(\"Controle\", \"Tratamento\")) +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Gráfico de barras mostrando a decomposição\ndecomp_data <- tibble(\n  Parametro = c(\"ATT\", \"ATU\", \"ATE\"),\n  Valor = c(effects$ATT, effects$ATU, effects$ATE_direct),\n  Peso = c(paste0(\"Peso: \", round(effects$prop_treated * 100, 1), \"%\"),\n           paste0(\"Peso: \", round((1 - effects$prop_treated) * 100, 1), \"%\"),\n           \"Média Ponderada\")\n)\n\nggplot(decomp_data, aes(x = Parametro, y = Valor, fill = Parametro)) +\n  geom_col(alpha = 0.8) +\n  geom_text(aes(label = paste0(\"$\", round(Valor, 0), \"\\n\", Peso)), \n            vjust = -0.5, size = 3.5) +\n  labs(\n    title = \"Decomposição do ATE\",\n    x = \"Parâmetro\",\n    y = \"Efeito do Tratamento ($)\",\n    fill = \"Parâmetro\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5),\n        legend.position = \"none\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Set2\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## As Hipóteses-Chave para Identificação Causal\n\nPara que possamos estimar os efeitos causais de forma válida a partir de dados observacionais, precisamos de algumas hipóteses que tornem a nossa análise crível. As três mais importantes são:\n\n### 1. Ignorabilidade (ou Independência Condicional)\n\nFormalmente, esta hipótese diz que, uma vez que controlamos por um conjunto de variáveis observáveis X, a alocação do tratamento é independente dos resultados potenciais.\n\n$$\n(Y^1, Y^0) \\perp D \\mid X\n$$\n\nEm um **experimento aleatório controlado (RCT)**, essa hipótese é garantida pelo próprio desenho, pois a aleatorização torna o tratamento independente de *qualquer* característica dos indivíduos, observada ou não. Em estudos observacionais, a plausibilidade da ignorabilidade depende da nossa capacidade de medir e controlar por todos os fatores de confusão relevantes (o conjunto X).\n\n### 2. Suporte Comum (ou Overlap)\n\nEsta hipótese garante que, para qualquer conjunto de características X, existem tanto indivíduos tratados quanto não tratados.\n\n$$\n0 < P(D=1 \\mid X) < 1\n$$\n\nIntuitivamente, não podemos comparar o incomparável. Se um programa de reforço escolar é oferecido apenas para alunos com notas muito baixas, não temos um grupo de controle com características similares (notas baixas) para fazer a comparação. A falta de suporte comum impede a estimação do efeito causal para certos subgrupos da população.\n\n### 3. SUTVA (Stable Unit Treatment Value Assumption)\n\nA SUTVA é composta por duas sub-hipóteses:\n\n-   **Consistência:** O resultado potencial de um indivíduo sob um determinado tratamento corresponde ao resultado observado se ele de fato recebe aquele tratamento. Isso implica que não existem múltiplas \"versões\" do tratamento com efeitos diferentes.\n-   **Não-Interferência:** O tratamento recebido por uma unidade não afeta os resultados potenciais de outra unidade. Por exemplo, em um programa de vacinação, a vacinação de uma pessoa pode gerar um efeito de transbordamento (spillover) positivo para outras, protegendo-as também. A SUTVA assume que esses efeitos de interferência não existem.\n\nSem as hipóteses de ignorabilidade e suporte comum, a identificação do efeito causal falha. Sem a SUTVA, os próprios resultados potenciais não estão bem definidos.\n\n\n\n\n## Como Obter Variação Exógena? Os Desenhos Clássicos de Identificação\n\nO grande objetivo dos métodos de inferência causal é encontrar (ou simular) uma fonte de variação no tratamento que seja \"tão boa quanto aleatória\". Cada método se baseia em um conjunto diferente de hipóteses para alcançar a identificação.\n\n### Experimentos Aleatórios Controlados (RCTs)\n\nConsiderado o **padrão-ouro**, o RCT resolve o problema do viés de seleção ao aleatorizar a alocação do tratamento. A randomização garante, em média, que os grupos de tratamento e controle sejam idênticos em todas as características, observáveis e não observáveis. Assim, qualquer diferença nos resultados pode ser atribuída ao tratamento.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}